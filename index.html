<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapas Mentais - Direito</title>
    <!-- 1. Importando o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Estilos CSS customizados -->
    <style>
        /* Fonte padrão */
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden; /* Previne scroll horizontal */
        }

        /* --- Estilos do Mapa Mental (Vertical) --- */
        /* (Estes são os mesmos estilos de antes, pois funcionam bem) */

        .mind-map-container {
            position: relative;
            padding-left: 40px;
        }

        .mind-map-container::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #cbd5e1;
        }

        .mind-map-item {
            position: relative;
            margin-top: 16px;
        }

        .mind-map-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 18px;
            width: 20px;
            height: 2px;
            background-color: #cbd5e1;
        }

        .mind-map-item::after {
            content: '';
            position: absolute;
            left: -28px;
            top: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #4f46e5;
            border: 2px solid white;
            z-index: 10;
        }

        .mind-map-item .mind-map-container {
            padding-left: 40px;
            margin-top: 16px;
        }

        /* --- Estilos do Novo Layout (Sidebar/Header) --- */
        
        /* Transição suave para o menu lateral */
        #sidebar {
            transition: transform 0.3s ease-in-out;
        }

        /* Transição para o overlay */
        #overlay {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- 3. Estrutura HTML do Aplicativo -->

    <!-- Barra Superior (Header) -->
    <header class="bg-white text-gray-800 shadow-md fixed top-0 left-0 right-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Lado Esquerdo: Hamburger e Logo -->
                <div class="flex items-center">
                    <!-- Botão Hamburger -->
                    <button id="hamburger-btn" class="p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-900">
                        <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <!-- Logo -->
                    <div class="ml-4 text-xl font-bold text-indigo-600">
                        DireitoMap
                    </div>
                </div>
                <!-- (Espaço para ícones à direita, se necessário) -->
            </div>
        </div>
    </header>

    <!-- Menu Lateral (Sidebar) -->
    <aside id="sidebar" class="bg-white w-72 h-full fixed top-0 left-0 z-40 shadow-xl transform -translate-x-full pt-16">
        <!-- O conteúdo do menu será gerado pelo JS aqui -->
        <nav id="sidebar-content" class="py-4 px-2 overflow-y-auto h-full"></nav>
    </aside>

    <!-- Overlay (fundo escuro quando o menu está aberto) -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>

    <!-- Área de Conteúdo Principal -->
    <main id="content-area" class="pt-24 pb-12 max-w-4xl mx-auto px-4">
        <!-- O mapa mental será carregado aqui -->
        <div class="bg-white p-8 rounded-lg shadow-lg text-center">
            <h2 class="text-2xl font-semibold text-gray-700">Bem-vindo(a) ao DireitoMap!</h2>
            <p class="mt-4 text-gray-500">Selecione uma disciplina e um tema no menu lateral para começar a estudar.</p>
        </div>
    </main>

    <!-- 4. O Código JavaScript -->
    <script>
        
        // --- INÍCIO DA SIMULAÇÃO DE DADOS (JSON) ---
        // Em um projeto real, estes dados viriam de arquivos separados.

        /**
         * Simula o arquivo "index.json" que lista todas as disciplinas e temas.
         * É assim que o menu sabe o que mostrar.
         */
        const mockMenuData = [
            {
                "disciplina": "Direito Civil",
                "temas": [
                    { "nome": "Contratos", "path": "data/Direito Civil/Contratos.json" },
                    { "nome": "Obrigações", "path": "data/Direito Civil/Obrigacoes.json" }
                ]
            },
            {
                "disciplina": "Direito Penal",
                "temas": [
                    { "nome": "Teoria do Crime", "path": "data/Direito Penal/Teoria do Crime.json" },
                    { "nome": "Tipos de Pena", "path": "data/Direito Penal/Penas.json" }
                ]
            },
            {
                "disciplina": "Direito Constitucional",
                "temas": [
                    { "nome": "Remédios Constitucionais", "path": "data/Direito Constitucional/Remedios.json" }
                ]
            }
        ];

        /**
         * Define a estrutura de um mapa mental.
         * Um tópico tem um "nome" e uma lista de "filhos" (subtópicos).
         * Se "filhos" for uma lista vazia, ele é um tópico final.
         */
        function definirTopico(nome, filhos = []) {
            return { nome, filhos };
        }

        /**
         * Simula o banco de dados de mapas mentais.
         * A "chave" (ex: "data/Direito Civil/Contratos.json") é o mesmo "path"
         * que definimos no 'mockMenuData'.
         */
        const mockMindMapData = {
            "data/Direito Civil/Contratos.json": {
                "titulo": "Contratos",
                "topicoRaiz": definirTopico("Contratos", [
                    definirTopico("Princípios Contratuais", [
                        definirTopico("Autonomia da Vontade"),
                        definirTopico("Boa-Fé Objetiva"),
                        definirTopico("Função Social do Contrato")
                    ]),
                    definirTopico("Formação dos Contratos", [
                        definirTopico("Proposta (Policitação)"),
                        definirTopico("Aceitação")
                    ]),
                    definirTopico("Extinção dos Contratos", [
                        definirTopico("Resilição"),
                        definirTopico("Resolução (por inadimplemento)"),
                        definirTopico("Rescisão")
                    ])
                ])
            },
            "data/Direito Civil/Obrigacoes.json": {
                "titulo": "Obrigações",
                "topicoRaiz": definirTopico("Obrigações", [
                    definirTopico("Conceito"),
                    definirTopico("Modalidades", [
                        definirTopico("Obrigação de Dar"),
                        definirTopico("Obrigação de Fazer"),
                        definirTopico("Obrigação de Não Fazer")
                    ])
                ])
            },
            "data/Direito Penal/Teoria do Crime.json": {
                "titulo": "Teoria do Crime",
                "topicoRaiz": definirTopico("Conceito Analítico de Crime", [
                    definirTopico("Fato Típico", [
                        definirTopico("Conduta"),
                        definirTopico("Resultado"),
                        definirTopico("Nexo Causal"),
                        definirTopico("Tipicidade")
                    ]),
                    definirTopico("Ilicitude (ou Antijuridicidade)"),
                    definirTopico("Culpabilidade")
                ])
            },
            "data/Direito Penal/Penas.json": {
                "titulo": "Tipos de Pena",
                "topicoRaiz": definirTopico("Penas (Art. 32 CP)", [
                    definirTopico("Privativas de Liberdade", [
                        definirTopico("Reclusão"),
                        definirTopico("Detenção"),
                    ]),
                    definirTopico("Restritivas de Direitos"),
                    definirTopico("Multa")
                ])
            },
            "data/Direito Constitucional/Remedios.json": {
                "titulo": "Remédios Constitucionais",
                "topicoRaiz": definirTopico("Remédios Constitucionais", [
                    definirTopico("Habeas Corpus"),
                    definirTopico("Habeas Data"),
                    definirTopico("Mandado de Segurança"),
                    definirTopico("Mandado de Injunção"),
                    definirTopico("Ação Popular")
                ])
            }
        };

        // --- FIM DA SIMULAÇÃO DE DADOS ---


        // Espera a página carregar para executar o script
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. Seleciona os elementos principais da UI
            const sidebar = document.getElementById('sidebar');
            const sidebarContent = document.getElementById('sidebar-content');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const overlay = document.getElementById('overlay');
            const contentArea = document.getElementById('content-area');

            // 2. Função para abrir/fechar o menu lateral
            function toggleSidebar() {
                sidebar.classList.toggle('-translate-x-full');
                sidebar.classList.toggle('translate-x-0');
                overlay.classList.toggle('hidden');
            }

            // 3. Função para construir o menu lateral dinamicamente
            function buildSidebarMenu() {
                let menuHtml = '';
                
                // Itera sobre cada disciplina no mockMenuData
                mockMenuData.forEach(disciplina => {
                    // Adiciona o título da disciplina (ex: Direito Civil)
                    // Usamos 'details' e 'summary' para criar um grupo "sanfona" (collapsible)
                    menuHtml += `<details class="group px-2 py-1">`;
                    menuHtml += `
                        <summary class="flex justify-between items-center p-2 rounded-md cursor-pointer hover:bg-gray-100">
                            <span class="font-semibold text-gray-700">${disciplina.disciplina}</span>
                            <!-- Ícone de seta que gira -->
                            <svg class="w-4 h-4 transform group-open:rotate-90 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </summary>
                    `;
                    
                    // Adiciona os temas (sub-itens)
                    menuHtml += `<ul class="pl-4 mt-1">`;
                    disciplina.temas.forEach(tema => {
                        menuHtml += `
                            <li>
                                <a href="#" 
                                   class="block p-2 rounded-md text-gray-600 hover:bg-indigo-50 hover:text-indigo-700"
                                   data-path="${tema.path}">
                                    ${tema.nome}
                                </a>
                            </li>
                        `;
                    });
                    menuHtml += `</ul></details>`;
                });
                
                sidebarContent.innerHTML = menuHtml;
            }

            // 4. Função para carregar um mapa mental na tela
            function loadMindMap(path) {
                // Busca o dado do mapa no nosso "banco de dados" simulado
                const mapData = mockMindMapData[path];

                if (!mapData) {
                    contentArea.innerHTML = `<p class="text-red-500">Erro: Mapa mental não encontrado para o caminho: ${path}</p>`;
                    return;
                }

                // Limpa o conteúdo antigo
                contentArea.innerHTML = '';

                // Cria o título
                const title = document.createElement('h1');
                title.className = "text-3xl md:text-4xl font-bold text-indigo-600 mb-12 text-center";
                title.textContent = mapData.titulo;
                contentArea.appendChild(title);

                // Cria o contêiner principal do mapa
                const mapContainer = document.createElement('div');
                mapContainer.className = "bg-white p-6 md:p-8 rounded-lg shadow-lg";

                const mindMapRoot = document.createElement('div');
                mindMapRoot.className = "mind-map-container";
                
                // Chama a função recursiva para construir o mapa
                const rootNode = createMapNode(mapData.topicoRaiz);
                mindMapRoot.appendChild(rootNode);
                
                mapContainer.appendChild(mindMapRoot);
                contentArea.appendChild(mapContainer);
            }

            /**
             * 5. Função Recursiva para criar os nós do mapa
             * "Recursiva" significa que a função chama a si mesma para criar
             * os filhos, netos, etc.
             */
            function createMapNode(nodeData) {
                // Cria o elemento 'div' principal para este item
                const item = document.createElement('div');
                item.className = 'mind-map-item';

                // Cria o 'span' para o texto do tópico
                const text = document.createElement('span');
                text.className = 'text-lg font-medium text-gray-900';
                text.textContent = nodeData.nome;
                text.dataset.topic = nodeData.nome; // Adiciona o data-topic
                item.appendChild(text);

                // Cria o botão de explicação
                const button = document.createElement('button');
                button.className = 'explain-btn ml-2 text-indigo-500 hover:text-indigo-700';
                button.dataset.topic = nodeData.nome;
                button.setAttribute('aria-label', `Explicar tópico ${nodeData.nome}`);
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                `;
                item.appendChild(button);

                // --- A MÁGICA DA RECURSÃO ---
                // Se este nó tiver filhos, cria um novo contêiner para eles
                if (nodeData.filhos && nodeData.filhos.length > 0) {
                    const childrenContainer = document.createElement('div');
                    childrenContainer.className = 'mind-map-container';

                    // Chama esta mesma função (createMapNode) para cada filho
                    nodeData.filhos.forEach(filhoNode => {
                        const filhoElement = createMapNode(filhoNode);
                        childrenContainer.appendChild(filhoElement);
                    });
                    
                    // Adiciona o contêiner de filhos ao item principal
                    item.appendChild(childrenContainer);
                }

                return item; // Retorna o item completo (com todos os seus filhos)
            }


            // --- 6. Configuração dos Eventos ---

            // Evento para abrir/fechar o menu
            hamburgerBtn.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', toggleSidebar);

            // Evento para cliques DENTRO do menu lateral (carregar mapas)
            sidebarContent.addEventListener('click', (event) => {
                // Procura pelo link 'a' mais próximo que foi clicado
                const link = event.target.closest('a[data-path]');
                
                if (link) {
                    event.preventDefault(); // Impede o link de navegar
                    const path = link.dataset.path;
                    loadMindMap(path);
                    toggleSidebar(); // Fecha o menu após clicar
                }
            });

            // Evento para cliques DENTRO da área de conteúdo (botões de explicação)
            contentArea.addEventListener('click', (event) => {
                const button = event.target.closest('.explain-btn');
                if (!button) {
                    return;
                }

                const topic = button.dataset.topic;
                if (!topic) {
                    return;
                }

                // Mesma lógica de antes para abrir o Google
                const query = `explique em detalhes o que é ${topic} no direito`;
                const encodedQuery = encodeURIComponent(query);
                const googleUrl = `https://www.google.com/search?q=${encodedQuery}`;
                window.open(googleUrl, '_blank');
            });


            // --- 7. Inicialização ---
            buildSidebarMenu(); // Constroi o menu assim que a página carrega

        });
    </script>

</body>
</html>

